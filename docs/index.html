<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, viewport-fit=cover"
  />
  <title>POH Reader</title>

  <link rel="apple-touch-icon" href="./apple-touch-icon-v2.png" />
  <link rel="icon" href="./logo.png" />
  <link rel="stylesheet" href="./style.css?v=20260124_1" />
</head>

<body>
  <!-- ================= TOP BAR (DESKTOP / TABLET) ================= -->
  <div class="topbar">
    <div class="brand">
      <img src="./logo.png" alt="POH Reader" />
      <span>POH Reader</span>
    </div>

    <div class="row navControls">
      <input id="file" type="file" accept="application/pdf" class="hiddenFile" />
      <button id="uploadBtn" class="uploadBtn">+ Upload POH / OM</button>

      <!-- Desktop nav controls (needed for bottom bar wiring too) -->
      <button id="prev" type="button">â—€ Prev</button>
      <button id="next" type="button">Next â–¶</button>
      <span id="pageInfo">Page: â€” / â€”</span>
    </div>

    <div class="spacer"></div>
  </div>

  <!-- ================= WELCOME / EMPTY STATE ================= -->
  <div id="emptyState" class="panel" style="margin:12px;">
    <h2>POH Reader</h2>
    <p>Upload your POH / OM once, then quickly search and listen.</p>
    <ul>
      <li><b>Search</b> = exact text search (fast + precise)</li>
      <li><b>Ask & Listen</b> = suggests the best pages/sections to check</li>
      <li><b>Listen</b> = read pages or sections out loud</li>
    </ul>
    <p style="opacity:.8;font-size:13px;">
      Reference tool only â€” always verify in the official POH / AFM.
    </p>
    <button id="emptyGotIt">Got it</button>
  </div>

  <!-- ================= MAIN LAYOUT ================= -->
  <main>
    <!-- LEFT PANEL -->
    <div class="panel panelLeft">
      <h3>Library</h3>
      <select id="librarySelect"></select>
      <div class="row">
        <button id="openFromLibraryBtn">Open</button>
        <button id="deleteFromLibraryBtn">Delete</button>
        <button id="clearLibraryBtn">Clear</button>
      </div>
      <div id="libraryStatus" class="sectionMeta"></div>

      <button id="feedbackBtn">Copy Feedback</button>
      <div id="feedbackStatus" class="sectionMeta"></div>

      <hr />

      <h3>Sections</h3>
      <div class="sectionHint">Jump to a section instantly.</div>
      <input id="sectionFilter" type="text" placeholder="Filter sectionsâ€¦" />
      <div id="sections" class="sectionsList"></div>

      <hr />

      <h3>Search within POH</h3>
      <div class="sectionHint">Exact text search (best for numbers, limits, and specific terms).</div>
      <input id="search" type="text" placeholder="Search textâ€¦" />
      <button id="searchBtn">Search POH (exact)</button>
      <button id="readHitsBtn" disabled>Read hits</button>
      <div id="searchResults" class="results"></div>
    </div>

    <!-- CENTER VIEWER -->
    <div class="viewer">
      <canvas id="canvas"></canvas>
    </div>

    <!-- RIGHT PANEL -->
    <div class="panel panelRight">
      <h3>Ask & Listen</h3>
      <div class="sectionHint">Contextual help â€” Iâ€™ll point you to the best pages/sections to check.</div>

      <textarea
        id="question"
        placeholder="Ask a question (local mode)â€¦"
      ></textarea>
      <button id="askBtn">Ask</button>

      <!-- Pilot Access -->
<div class="pilot-access">
  <a
    class="pilot-access-btn"
    href="https://buy.stripe.com/5kQaEXccuguagFt6y0AM00"
    target="_blank"
    rel="noopener noreferrer"
  >
    Get Pilot Access â€“ â‚¬12/month
  </a>

  <div class="pilot-access-note">
    <strong>Important notice</strong><br />
    POH Reader is a decision-support and study tool only.<br />
    It does not replace the official POH/AFM or approved flight documentation.<br />
    The pilot in command remains solely responsible for aircraft operation and compliance.
  </div>
</div>

      <div id="bestPlacesWrap" class="card" style="margin-top:12px;">
        <div class="sectionTitle">
          Best places to look
          <span id="buildStamp" style="opacity:.5;font-size:12px;margin-left:8px;"></span>
        </div>
        <div class="sectionMeta">
          Offline mode: Iâ€™m pointing you to the most relevant pages.
        </div>
        <div id="bestPlaces"></div>
      </div>

      <div class="row" style="margin-top:8px;">
        <button id="micBtn">ðŸŽ¤ Hold to talk</button>
      </div>
      <div id="micStatus" class="sectionMeta"></div>

      <hr />

      <!-- IMPORTANT: only ONE #answer in the DOM -->
      <div id="answer" class="answer"></div>

      <div class="safetyLine">
        Safety: Always verify in the official POH/AFM.
      </div>

      <div id="ttsControls" class="ttsControls">
        <button id="readPageBtn">Read page</button>
        <button id="readSectionBtn">Read section</button>
        <button id="stopReadBtn">Stop</button>

        <!-- IMPORTANT: only ONE Resume button in the whole DOM -->
        <button id="resumeReadBtn">Resume</button>

        <label>Speed</label>
        <input id="ttsRate" type="range" min="0.6" max="1.4" step="0.1" value="1" />
        <select id="voiceSelect"></select>
      </div>
    </div>
  </main>

  <!-- ================= MOBILE BOTTOM BAR ================= -->
  <div class="bottomBar">
    <button id="bottomPrev" class="bottomBtn">â—€</button>
    <button id="bottomUpload" class="bottomBtn primary">Upload</button>
    <button id="bottomSearch" class="bottomBtn">Search</button>
    <button id="bottomNext" class="bottomBtn">â–¶</button>
  </div>

  <!-- ================= SCRIPTS ================= -->
  <script type="module" src="./app.js"></script>

  <script>
    // Empty state helper
    window.setEmptyStateVisible = function (visible) {
      const el = document.getElementById("emptyState");
      if (!el) return;
      el.style.display = visible ? "block" : "none";
    };

    document.getElementById("emptyGotIt")?.addEventListener("click", () => {
      window.setEmptyStateVisible(false);
    });

    // Wire bottom bar to top controls
    (function () {
      const byId = (id) => document.getElementById(id);

      const topUpload = byId("uploadBtn");
      const topPrev = byId("prev");
      const topNext = byId("next");
      const topSearch = byId("searchBtn");

      byId("bottomUpload")?.addEventListener("click", () => topUpload?.click());
      byId("bottomPrev")?.addEventListener("click", () => topPrev?.click());
      byId("bottomNext")?.addEventListener("click", () => topNext?.click());
      byId("bottomSearch")?.addEventListener("click", () => topSearch?.click());
    })();
  </script>
</body>
</html>