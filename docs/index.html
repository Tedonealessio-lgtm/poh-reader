<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>POH Reader</title>

    <link rel="icon" href="./logo.png" />
    <link rel="apple-touch-icon" href="./apple-touch-icon.png" />
    <link rel="stylesheet" href="./style.css" />
    </head>

    <style>
      /* --- BRAND HEADER --- */
      .brand {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .brand img {
        width: 34px;
        height: 34px;
        border-radius: 8px;
      }

      .brand span {
        font-size: 16px;
        font-weight: 600;
        letter-spacing: 0.6px;
      }

      @media (max-width: 768px) {
        .brand span {
          font-size: 15px;
        }
      }

      /* --- MIC BUTTON --- */
      #micBtn {
        font-weight: 600;
        border-radius: 10px;
        font-size: 14px;
      }

      #micBtn:active {
        transform: scale(0.98);
      }

      #micStatus {
        font-size: 12px;
        opacity: 0.75;
        margin-top: 6px;
      }

      /* feedback textarea small and tidy */
      #feedbackText {
        width: 100%;
        height: 80px;
        margin-top: 8px;
        resize: vertical;
      }
    </style>
  </head>

  <body>
    <!-- TOP BAR -->
    <header class="topbar">
      <div class="row" style="justify-content: space-between; width: 100%">
        <!-- BRAND -->
        <div class="brand">
          <img src="./logo.png" alt="POH Reader logo" />
          <span>POH READER</span>
        </div>

        <!-- CONTROLS -->
        <div class="row">
          <input id="file" type="file" accept="application/pdf" />
          <button id="prev" disabled>‚óÄ Prev</button>
          <button id="next" disabled>Next ‚ñ∂</button>
          <span id="pageInfo">Page: ‚Äì / ‚Äì</span>
        </div>
      </div>
    </header>

    <main class="layout">
      <!-- LEFT PANEL -->
      <section class="panel tabSection" data-tab-section="search">
        <!-- LIBRARY -->
        <h2>Library</h2>

        <select id="librarySelect" style="width: 100%; margin: 8px 0">
          <option value="">(No saved PDFs yet)</option>
        </select>

        <div class="row" style="gap: 8px">
          <button id="openFromLibraryBtn">Open</button>
          <button id="deleteFromLibraryBtn">Delete</button>
          <button id="clearLibraryBtn">Clear</button>
        </div>

        <div class="row" style="gap: 8px; margin-top: 8px; align-items:center;">
          <button id="feedbackBtn">Copy Feedback</button>
          <span id="feedbackStatus" style="opacity: 0.8"></span>
        </div>

        <!-- ‚úÖ ADD: where you write feedback -->
        <textarea
          id="feedbackText"
          placeholder="Write feedback (device, bug, idea, page number, etc.)"
        ></textarea>

        <div id="libraryStatus" style="opacity: 0.7; font-size: 12px; margin: 8px 0"></div>

        <hr style="margin: 12px 0" />

        <h2>Sections</h2>
        <div id="sections" class="results"></div>

        <h2 style="margin-top: 12px">Search</h2>

        <div class="row">
          <select id="sectionFilter" disabled>
            <option value="ALL">All sections</option>
          </select>
        </div>

        <div class="row">
          <input
            id="search"
            type="text"
            placeholder="Search (e.g. ITT takeoff limit)"
            disabled
          />
          <button id="searchBtn" disabled>Search</button>
        </div>

        <div class="row">
          <button id="readHitsBtn" disabled>üéØ Read search hits</button>
        </div>

        <div id="searchResults" class="results"></div>
      </section>

      <!-- CENTER VIEWER -->
      <section class="viewer tabSection" data-tab-section="viewer">
        <canvas id="canvas"></canvas>
      </section>

      <!-- RIGHT PANEL -->
      <section class="panel tabSection" data-tab-section="ask">
        <h2>Ask & Listen</h2>

        <textarea
          id="question"
          rows="6"
          placeholder="Ask a question (e.g. ITT limit during takeoff)‚Ä¶"
          disabled
        ></textarea>

        <!-- VOICE ASK CONTROLS -->
        <div class="row" style="margin-top: 8px; gap: 8px">
          <button id="micBtn" disabled style="flex: 1">üéô Hold to talk</button>
          <button id="askBtn" disabled>‚ùì Ask</button>
        </div>

        <div id="micStatus">Mic ready.</div>

        <div id="answer" class="answer"></div>

        <h3 style="margin-top: 14px">Voice Read</h3>

        <div class="row">
          <button id="readPageBtn" disabled>üîä Read page</button>
          <button id="readSectionBtn" disabled>üìñ Read section</button>
          <button id="stopReadBtn" disabled>‚èπ Stop</button>
        </div>

        <div class="row" style="margin-top: 8px">
          <label style="font-size: 12px; opacity: 0.7">Speed</label>
          <input
            id="ttsRate"
            type="range"
            min="0.7"
            max="1.4"
            step="0.1"
            value="1.0"
            disabled
          />
        </div>

        <div class="row" style="margin-top: 8px">
          <label style="font-size: 12px; opacity: 0.7">Voice</label>
          <select id="voiceSelect" disabled style="flex: 1"></select>
        </div>

        <div style="margin-top: 14px; font-size: 11px; opacity: 0.7; line-height: 1.4">
          ‚ö†Ô∏è <b>Reference tool only.</b><br />
          Does not replace the official POH / AFM.<br />
          Always verify limitations and procedures before flight.
        </div>
      </section>
    </main>

    <script type="module" src="./app.js"></script>

    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker
            .register("./sw.js")
            .then((reg) => console.log("‚úÖ SW registered:", reg.scope))
            .catch((err) => console.error("‚ùå SW registration failed:", err));
        });
      }
    </script>
  </body>
</html>
