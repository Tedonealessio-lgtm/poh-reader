<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>POH Reader</title>
  <link rel="stylesheet" href="./style.css?v=44" />
  <link rel="apple-touch-icon" href="./apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="180x180" href="./apple-touch-icon-v2.png">
</head>

<body>
  <!-- hidden real file input -->
  <input id="file" class="hiddenFile" type="file" accept="application/pdf" />

  <header class="topbar">
  <div class="brand">
    <img src="./logo.png" alt="POH Reader logo" class="appLogo" />
    <div class="brandText">
      <div class="brandTitle">POH Reader</div>
      <div class="brandSub">Offline POH / OM reader ‚Ä¢ Search ‚Ä¢ Listen</div>
    </div>
  </div>

  <div class="row topActions">
   <button
  id="themeToggle"
  class="iconBtn"
  type="button"
  title="Toggle light / dark"
  aria-label="Toggle theme">
  üåô
</button>

    <button id="uploadBtn" class="uploadBtn">+ Upload POH / OM</button>
    <div id="pageInfo" class="pageInfo">Page: ‚Äì / ‚Äì</div>
  </div>
</header>

  <main>
    <!-- LEFT -->
    <section class="panel panelLeft">
      <h2>Library</h2>
      <select id="librarySelect"></select>
      <div class="row">
        <button id="openFromLibraryBtn">Open</button>
        <button id="deleteFromLibraryBtn">Delete</button>
        <button id="clearLibraryBtn">Clear</button>
      </div>
      <div id="libraryStatus" class="sectionMeta"></div>

      <div class="row" style="margin-top:10px;">
        <button id="feedbackBtn" style="width:100%;">Copy Feedback</button>
      </div>

      <hr />

      <h2>Sections</h2>
      <div class="sectionHint">Jump to a section instantly.</div>
      <input id="sectionFilter" type="text" placeholder="Filter sections..." />
      <div id="sectionsList" class="sectionsList"></div>

      <hr />

      <h2>Search within POH</h2>
      <div class="sectionHint">Exact text search (best for numbers/limits).</div>
      <input id="searchInput" type="text" placeholder="Search text‚Ä¶" />
      <div class="row">
        <button id="searchBtn">Search</button>
      </div>
      <div id="searchResults" class="results"></div>
    </section>

    <!-- CENTER VIEWER -->
    <section class="viewer">
      <canvas id="canvas"></canvas>
    </section>

    <!-- RIGHT -->
    <section class="panel panelRight">
      <h2>Ask &amp; Listen</h2>
      <div class="sectionHint">
        Offline guidance: I‚Äôll point you to relevant pages.
        <div class="sectionMeta">Decision-support only.</div>
      </div>

      <textarea id="question" rows="2" placeholder="Ask a question (local mode)‚Ä¶"></textarea>
      <button id="askBtn">Ask</button>

      <!-- IMPORTANT: this is where the ‚Äújump cards‚Äù render -->
      <div class="row" style="margin-top:10px;">
        <button id="micBtn">üé§ Hold to talk</button>
      </div>
      <div id="micStatus" class="sectionMeta"></div>

      <div class="safetyLine">Always verify in the official POH/AFM.</div>

       <div id="bestPlacesWrap" class="bestPlacesWrap" style="display:none;">
        <div id="bestPlaces"></div>
      </div>

      <details class="subBox">
        <summary>Pilot Subscription</summary>
        <div class="subInner">
          <button id="subscribeBtn" class="subscribeBtn">Subscribe</button>
          <div class="subText">
            Keep using POH Reader freely ‚Äî subscribing helps fund development and future features.
            <ul>
              <li>Early access to improvements &amp; new features</li>
              <li>Priority feedback channel</li>
              <li>Cancel anytime in Stripe</li>
            </ul>
            <strong>Important notice</strong><br/>
            POH Reader is a decision-support and study tool only. It does not replace the official POH/AFM or approved flight documentation.
            The pilot in command remains solely responsible for aircraft operation and compliance.
          </div>
        </div>
      </details>

      <div id="answer" class="answer"></div>

      <div id="ttsControls" class="ttsControls">
        <div class="row">
          <button id="readPageBtn">Read page</button>
          <button id="readSectionBtn">Read section</button>
          <button id="stopReadBtn">Stop</button>
          <button id="resumeReadBtn" disabled>Resume</button>
        </div>

        <div class="row" style="margin-top:8px;">
          <label style="flex:1;">Voice
            <select id="voiceSelect"></select>
          </label>
        </div>

        <div class="row" style="margin-top:8px;align-items:center;">
          <div style="min-width:60px;opacity:.85;">Speed</div>
          <input id="speedRange" type="range" min="0.7" max="1.3" step="0.05" value="1.0" style="width:100%;">
        </div>
      </div>
    </section>
  </main>

<!-- MOBILE DOCK -->
<div id="bottomDock" class="dockExpanded">
  <button id="bottomDockToggle" type="button" aria-label="Toggle bottom dock">‚ñº</button>

  <nav class="bottomBar" id="bottomBar" aria-label="Bottom navigation">
    <button id="bottomPrev" class="bottomBtn">‚óÄ</button>
    <button id="bottomUpload" class="bottomBtn primary">Upload</button>
    <button id="bottomSearch" class="bottomBtn">Read page</button>
    <button id="bottomNext" class="bottomBtn">‚ñ∂</button>
  </nav>
</div>

  <!-- Pilot Subscription Paywall Modal -->
<!-- Paywall -->
<div id="paywallOverlay" hidden>
  <div id="paywallModal" role="dialog" aria-modal="true" aria-labelledby="paywallTitle">
    <button id="paywallClose" class="paywallClose" aria-label="Close">√ó</button>

    <h3 id="paywallTitle">Pilot Subscription</h3>

    <p id="paywallMsg" class="paywallMsg">
      Unlock this feature with Pilot Subscription (7,99 ‚Ç¨).
    </p>

    <ul class="paywallList">
      <li><b>Ask</b> ‚Äî guidance + ‚ÄúBest places to look‚Äù</li>
      <li><b>Read aloud</b> ‚Äî page/section audio with Resume</li>
    </ul>

    <div class="paywallActions">
      <a id="paywallSubscribeBtn" class="btnPrimary" href="#" target="_blank" rel="noopener">
        Subscribe ‚Äî 7,99 ‚Ç¨
      </a>

      <button id="paywallAlreadyBtn" class="btnLink" type="button">
        I already subscribed
      </button>
    </div>

    <div id="paywallUnlockRow" class="unlockRow" hidden>
      <label class="srOnly" for="paywallCode">Unlock code</label>
      <input id="paywallCode" type="text" inputmode="text" autocomplete="one-time-code"
             placeholder="Enter unlock code" />
      <button id="paywallUnlockBtn" class="btnSecondary" type="button">Unlock</button>
      <div id="paywallUnlockHint" class="unlockHint">Tip: paste the code you received after subscribing.</div>
    </div>

    <div class="paywallFooter">
      Manuals stay on your device. No upload required.
    </div>
  </div>
</div>

<script type="module" src="./app.js?v=44"></script>

<script>
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("sw.js?v=44")
        .then(reg => {
          console.log("SW registered:", reg.scope);
        })
        .catch(err => {
          console.error("SW registration failed:", err);
        });
    });
  }
</script>

</body>
</html>