<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, viewport-fit=cover"
  />
  <title>POH Reader</title>

  <link rel="apple-touch-icon" href="./apple-touch-icon-v2.png" />
  <link rel="icon" href="./logo.png" />
  <link rel="stylesheet" href="style.css?v=20260124b">
</head>

<body>
  <!-- ================= TOP BAR (BRAND ONLY) ================= -->
  <div class="topbar">
    <div class="brand">
      <img src="./logo.png" alt="POH Reader" />
      <span>POH Reader</span>
    </div>
    <div class="spacer"></div>

    <!-- Keep file input available (hidden). Upload is bottom-bar only -->
    <input id="file" type="file" accept="application/pdf" class="hiddenFile" />
  </div>

  <!-- ================= WELCOME / EMPTY STATE ================= -->
  <div id="emptyState" class="panel emptyState">
    <h2>POH Reader</h2>
    <p>Upload your POH/OM once, then quickly search and listen.</p>
    <p class="muted">Decision-support only â€” always verify in the official POH/AFM.</p>
    <button id="emptyGotIt">Got it</button>
  </div>

  <!-- ================= MAIN LAYOUT ================= -->
  <main>
    <!-- LEFT PANEL -->
    <div class="panel panelLeft">
      <h3>Library</h3>
      <select id="librarySelect"></select>
      <div class="row">
        <button id="openFromLibraryBtn">Open</button>
        <button id="deleteFromLibraryBtn">Delete</button>
        <button id="clearLibraryBtn">Clear</button>
      </div>
      <div id="libraryStatus" class="sectionMeta"></div>

      <button id="feedbackBtn">Copy Feedback</button>
      <div id="feedbackStatus" class="sectionMeta"></div>

      <hr />

      <h3>Sections</h3>
      <div class="sectionHint">Jump instantly.</div>
      <input id="sectionFilter" type="text" placeholder="Filter sectionsâ€¦" />
      <div id="sections" class="sectionsList"></div>

      <hr />

      <h3>Search</h3>
      <div class="sectionHint">Exact text search (best for numbers/limits).</div>
      <input id="searchQuery" type="text" placeholder="Search text..." />
      <button id="searchBtn">Search POH (exact)</button>
      <button id="readHitsBtn" disabled>Read hits</button>
      <div id="searchStatus" class="muted"></div>
      <div id="searchResults" class="results"></div>
    </div>

    <!-- CENTER VIEWER -->
    <div class="viewer">
      <canvas id="canvas"></canvas>
    </div>

    <!-- RIGHT PANEL -->
    <div class="panel panelRight">
      <h3>Ask & Listen</h3>
      <div class="sectionHint">
        Offline guidance: Iâ€™ll point you to relevant pages.
      </div>

      <textarea id="question" placeholder="Ask a question (local mode)â€¦"></textarea>
      <button id="askBtn">Ask</button>

      <!-- Jump cards only (no â€œBest placesâ€¦â€ header, no extra text) -->
      <div id="bestPlacesWrap" class="card" style="display:none;">
        <div id="bestPlaces"></div>
      </div>

      <div class="row" style="margin-top:10px;">
        <button id="micBtn">ðŸŽ¤ Hold to talk</button>
      </div>
      <div id="micStatus" class="sectionMeta"></div>

      <hr />

      <!-- Answer/notes area (kept, but you can keep it empty in local mode) -->
      <div id="answer" class="answer"></div>
      <div class="safetyLine">Always verify in the official POH/AFM.</div>

      <!-- Subscription moved DOWN + collapsed (no confusion, no wall of text) -->
      <details class="pilot-access">
        <summary>Pilot Subscription</summary>

        <div class="pilot-access-inner">
          <div class="muted" style="margin:6px 0 10px 0;">
            Optional. Helps fund development.
          </div>

          <script async src="https://js.stripe.com/v3/buy-button.js"></script>
          <stripe-buy-button
            buy-button-id="buy_btn_1StCz0FxeWDYlHcnStVuEg5w"
            publishable-key="pk_live_51St9L8FxeWDYlHcn8sBDfnXzozoEGIu5JTYvXXnGYX7pmgwcdNisK4kn2WjJWBiTBb8UoTbWQQiKkkrDQxofHtF000fCwYa4lX"
          ></stripe-buy-button>

          <div class="muted" style="margin-top:10px;">
            Decision-support only. Cancel anytime in Stripe.
          </div>
        </div>
      </details>

      <div id="ttsControls" class="ttsControls">
        <button id="readPageBtn">Read page</button>
        <button id="readSectionBtn">Read section</button>
        <button id="stopReadBtn">Stop</button>
        <button id="resumeReadBtn">Resume</button>

        <label>Speed</label>
        <input id="ttsRate" type="range" min="0.6" max="1.4" step="0.1" value="1" />
        <select id="voiceSelect"></select>
      </div>
    </div>
  </main>

  <!-- ================= MOBILE BOTTOM BAR (ONLY CONTROLS) ================= -->
  <div class="bottomBar">
    <button id="bottomPrev" class="bottomBtn">â—€</button>
    <button id="bottomUpload" class="bottomBtn primary">Upload POH here</button>
    <button id="bottomSearch" class="bottomBtn">Search</button>
    <button id="bottomNext" class="bottomBtn">â–¶</button>
  </div>

  <!-- ================= SCRIPTS ================= -->
  <script type="module" src="./app.js?v=20260124b"></script>

  <script>
    window.setEmptyStateVisible = function (visible) {
      const el = document.getElementById("emptyState");
      if (!el) return;
      el.style.display = visible ? "block" : "none";
    };

    document.getElementById("emptyGotIt")?.addEventListener("click", () => {
      window.setEmptyStateVisible(false);
    });
  </script>
</body>
</html>